--[[
    BOOGA BOOGA REBORN GOLD FARMING SCRIPT
    Features:
    - Gold farming with multiple tween points
    - Auto drop ALL raw gold (waits and drops everything)
    - Auto coin press with correct Gold item ID
]]

local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/Scripting137/Nevox/refs/heads/main/Ui"))()
local rs = game:GetService("ReplicatedStorage")
local HttpService = game:GetService("HttpService")
local PathfindingService = game:GetService("PathfindingService")
local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")

local packets = require(rs.Modules.Packets)
local plr = Players.LocalPlayer

local char = plr.Character or plr.CharacterAdded:Wait()
local root = char:WaitForChild("HumanoidRootPart")

-- Variables
local goldFarmEnabled = false
local pointsVisible = true
local tweenSpeed = 16
local goldFarmPoints = {} 
local dropPoint = nil
local selectedPointIndex = 1
local pointMarkers = {}
local activeTween = nil
local pointDropdown = nil
local SAVE_FILE = "NevoxGold_v2.json"

-- Toggles
local autoDropEnabled = false
local autoCoinPressEnabled = false

-- Item IDs (find correct ones in game)
local GOLD_ITEM_ID = 50  -- Default Gold item ID (check in game)
local COIN_MACHINE_ENTITY_ID = 21056

-- [[ FUNCTIONS ]] --
local function updatePointsUI()
    local names = {}
    for i, _ in ipairs(goldFarmPoints) do 
        table.insert(names, "Point " .. i) 
    end
    
    if pointDropdown then 
        pointDropdown:Refresh(names) 
    end
    
    for _, v in pairs(pointMarkers) do 
        v:Destroy() 
    end
    pointMarkers = {}
    
    if not pointsVisible then 
        return 
    end

    for i, pos in ipairs(goldFarmPoints) do
        local markerPart = Instance.new("Part")
        markerPart.Size = Vector3.new(1.5, 1.5, 1.5)
        markerPart.Position = pos
        markerPart.Anchored = true
        markerPart.CanCollide = false
        markerPart.Transparency = 0.5
        markerPart.Material = Enum.Material.Neon
        if i == selectedPointIndex then
            markerPart.Color = Color3.new(1, 1, 1)
        else
            markerPart.Color = Color3.fromRGB(255, 215, 0)
        end
        markerPart.Parent = workspace
        
        local bgui = Instance.new("BillboardGui", markerPart)
        bgui.AlwaysOnTop = true
        bgui.Size = UDim2.new(0, 40, 0, 40)
        bgui.ExtentsOffset = Vector3.new(0, 2, 0)
        
        local lbl = Instance.new("TextLabel", bgui)
        lbl.BackgroundTransparency = 1
        lbl.Size = UDim2.new(1, 0, 1, 0)
        lbl.Text = tostring(i)
        lbl.TextColor3 = Color3.new(1, 1, 1)
        lbl.TextSize = 16
        lbl.Font = Enum.Font.GothamBold
        
        table.insert(pointMarkers, markerPart)
    end
    
    if dropPoint then
        local dropMarker = Instance.new("Part")
        dropMarker.Size = Vector3.new(2, 2, 2)
        dropMarker.Position = dropPoint
        dropMarker.Anchored = true
        dropMarker.CanCollide = false
        dropMarker.Transparency = 0.4
        dropMarker.Material = Enum.Material.Neon
        dropMarker.Color = Color3.fromRGB(0, 255, 0)
        dropMarker.Parent = workspace
        
        local dbgui = Instance.new("BillboardGui", dropMarker)
        dbgui.AlwaysOnTop = true
        dbgui.Size = UDim2.new(0, 50, 0, 50)
        dbgui.ExtentsOffset = Vector3.new(0, 2.5, 0)
        
        local dlbl = Instance.new("TextLabel", dbgui)
        dlbl.BackgroundTransparency = 1
        dlbl.Size = UDim2.new(1, 0, 1, 0)
        dlbl.Text = "DROP"
        dlbl.TextColor3 = Color3.new(0, 1, 0)
        dlbl.TextSize = 18
        dlbl.Font = Enum.Font.GothamBold
        
        table.insert(pointMarkers, dropMarker)
    end
end

local function savePoints()
    local data = {
        farmPoints = {},
        dropPoint = dropPoint and {dropPoint.X, dropPoint.Y, dropPoint.Z} or nil
    }
    
    for _, pos in ipairs(goldFarmPoints) do
        table.insert(data.farmPoints, {pos.X, pos.Y, pos.Z})
    end
    
    if writefile then 
        writefile(SAVE_FILE, HttpService:JSONEncode(data)) 
    end
end

local function loadPoints()
    if isfile and isfile(SAVE_FILE) then
        local success, data = pcall(function() 
            return HttpService:JSONDecode(readfile(SAVE_FILE)) 
        end)
        if success and data then
            goldFarmPoints = {}
            if data.farmPoints then
                for _, posArr in ipairs(data.farmPoints) do
                    table.insert(goldFarmPoints, Vector3.new(posArr[1], posArr[2], posArr[3]))
                end
            end
            
            if data.dropPoint then
                dropPoint = Vector3.new(data.dropPoint[1], data.dropPoint[2], data.dropPoint[3])
            end
        end
    end
    updatePointsUI()
end

local function pickupItems()
    local items = workspace:FindFirstChild("Items")
    if items then
        for _, item in ipairs(items:GetChildren()) do
            local name = item.Name
            if name == "Raw Gold" or name == "Coin" or name == "Gold" then
                local pos = item:GetPivot().Position
                if (pos - root.Position).Magnitude < 45 then
                    pcall(function() 
                        packets.Pickup.send(item:GetAttribute("EntityID")) 
                    end)
                end
            end
        end
    end
end

local function walkTo(targetPos)
    if not goldFarmEnabled then return end
    
    local path = PathfindingService:CreatePath({
        AgentRadius = 2,
        AgentHeight = 5,
        AgentCanJump = true,
        WaypointSpacing = 8
    })
    
    path:ComputeAsync(root.Position, targetPos)
    local waypoints = path:GetWaypoints()
    
    if path.Status == Enum.PathStatus.Success then
        for _, waypoint in ipairs(waypoints) do
            if not goldFarmEnabled then break end
            
            local dist = (root.Position - waypoint.Position).Magnitude
            if dist > 2.5 then
                local tInfo = TweenInfo.new(dist / tweenSpeed, Enum.EasingStyle.Linear)
                activeTween = TweenService:Create(root, tInfo, {CFrame = CFrame.new(waypoint.Position + Vector3.new(0, 3, 0))})
                activeTween:Play()
                activeTween.Completed:Wait()
            end
        end
    else
        local dist = (targetPos - root.Position).Magnitude
        activeTween = TweenService:Create(root, TweenInfo.new(dist / tweenSpeed), {CFrame = CFrame.new(targetPos + Vector3.new(0, 3, 0))})
        activeTween:Play()
        activeTween.Completed:Wait()
    end
end

-- [[ GET INVENTORY ITEMS ]] --
local function getInventoryItems()
    local items = {}
    local inventory = plr.PlayerGui:FindFirstChild("MainGui")
    if not inventory then return items end
    inventory = inventory:FindFirstChild("RightPanel")
    if not inventory then return items end
    inventory = inventory:FindFirstChild("Inventory")
    if not inventory then return items end
    local list = inventory:FindFirstChild("List")
    if not list then return items end
    
    for _, child in ipairs(list:GetChildren()) do
        if child:IsA("ImageLabel") and child.Name ~= "" then
            table.insert(items, {
                name = child.Name,
                layoutOrder = child.LayoutOrder,
                object = child
            })
        end
    end
    
    return items
end

-- [[ DROP ALL RAW GOLD (WITH WAIT) ]] --
local function dropAllRawGold()
    if not autoDropEnabled or not dropPoint then return end
    
    print("[Auto Drop] Going to drop point...")
    walkTo(dropPoint)
    task.wait(1)
    
    -- Keep dropping until no raw gold left
    local attempts = 0
    local totalDropped = 0
    
    while attempts < 10 do  -- Max 10 attempts
        attempts = attempts + 1
        
        local inventoryItems = getInventoryItems()
        local rawGoldCount = 0
        local rawGoldLayoutOrders = {}
        
        -- Count raw gold
        for _, item in ipairs(inventoryItems) do
            if item.name == "Raw Gold" then
                rawGoldCount = rawGoldCount + 1
                table.insert(rawGoldLayoutOrders, item.layoutOrder)
            end
        end
        
        if rawGoldCount == 0 then
            print("[Auto Drop] No more Raw Gold to drop")
            break
        end
        
        print("[Auto Drop] Dropping " .. rawGoldCount .. " Raw Gold items...")
        
        -- Drop all raw gold
        for _, layoutOrder in ipairs(rawGoldLayoutOrders) do
            pcall(function()
                packets.DropBagItem.send(layoutOrder)
                totalDropped = totalDropped + 1
            end)
            task.wait(0.05)
        end
        
        print("[Auto Drop] Dropped batch, waiting...")
        task.wait(1)  -- Wait for inventory to update
    end
    
    if totalDropped > 0 then
        print("[Auto Drop] TOTAL Dropped " .. totalDropped .. " Raw Gold")
    end
    
    return totalDropped
end

-- [[ AUTO COIN PRESS WITH CORRECT ITEM ID ]] --
local function pressCoinWithGold()
    if not autoCoinPressEnabled then return false end
    
    -- Find nearest coin machine
    local coinMachineID = COIN_MACHINE_ENTITY_ID
    local foundMachines = {}
    
    for _, obj in pairs(workspace:GetChildren()) do
        if obj:IsA("Model") and (string.find(string.lower(obj.Name), "coin") or string.find(string.lower(obj.Name), "press")) then
            local ppart = obj.PrimaryPart or obj:FindFirstChildWhichIsA("BasePart")
            if ppart then
                local entityID = obj:GetAttribute("EntityID")
                if entityID then
                    table.insert(foundMachines, {
                        entityID = entityID,
                        distance = (ppart.Position - root.Position).Magnitude
                    })
                end
            end
        end
    end
    
    if #foundMachines > 0 then
        table.sort(foundMachines, function(a, b) return a.distance < b.distance end)
        coinMachineID = foundMachines[1].entityID
    end
    
    -- Check if we have Gold in inventory
    local inventoryItems = getInventoryItems()
    local hasGold = false
    
    for _, item in ipairs(inventoryItems) do
        if item.name == "Gold" then
            hasGold = true
            break
        end
    end
    
    if not hasGold then
        return false
    end
    
    -- Press coin with Gold item ID
    pcall(function()
        packets.InteractStructure.send({
            entityID = coinMachineID,
            itemID = GOLD_ITEM_ID
        })
        print("[Coin Press] Pressed coin with Gold item ID: " .. GOLD_ITEM_ID)
    end)
    
    return true
end

-- [[ UI ]] --
local Window = Library:Window({
    Name = "Nevox - Gold Farm",
    SubName = "Booga Booga Reborn",
    Logo = "120959262762131"
})

local FarmingPage = Window:Page({Name = "Gold Farming", Icon = "123554105934637"})

local MainSection = FarmingPage:Section({Name = "Gold Farm", Side = 1})

MainSection:Toggle({
    Name = "Master Gold Farm",
    Flag = "GoldFarm",
    Callback = function(v) 
        goldFarmEnabled = v 
        if not v and activeTween then 
            activeTween:Cancel() 
        end
    end
})

MainSection:Toggle({
    Name = "Show Tween Points",
    Default = true,
    Callback = function(v)
        pointsVisible = v
        updatePointsUI()
    end
})

MainSection:Slider({
    Name = "Tween Speed",
    Min = 10,
    Max = 35,
    Default = 16,
    Callback = function(v) 
        tweenSpeed = v 
    end
})

pointDropdown = MainSection:Dropdown({
    Name = "Select Point",
    Items = {},
    Callback = function(v) 
        local num = v:match("%d+")
        selectedPointIndex = tonumber(num) or 1
        updatePointsUI()
    end
})

MainSection:Button({
    Name = "Add Farm Point (Current)",
    Callback = function()
        table.insert(goldFarmPoints, root.Position)
        savePoints()
        updatePointsUI()
    end
})

MainSection:Button({
    Name = "Set Drop Point (Current)",
    Callback = function()
        dropPoint = root.Position
        savePoints()
        updatePointsUI()
    end
})

MainSection:Button({
    Name = "Bring Point to Me",
    Callback = function()
        if goldFarmPoints[selectedPointIndex] then
            goldFarmPoints[selectedPointIndex] = root.Position
            savePoints()
            updatePointsUI()
        end
    end
})

MainSection:Button({
    Name = "Remove Selected Point",
    Callback = function()
        if #goldFarmPoints > 0 then
            table.remove(goldFarmPoints, selectedPointIndex)
            if selectedPointIndex > #goldFarmPoints then
                selectedPointIndex = #goldFarmPoints
            end
            savePoints()
            updatePointsUI()
        end
    end
})

MainSection:Button({
    Name = "Clear All Points",
    Callback = function()
        goldFarmPoints = {}
        dropPoint = nil
        savePoints()
        updatePointsUI()
    end
})

local AutoSection = FarmingPage:Section({Name = "Auto Systems", Side = 2})

AutoSection:Toggle({
    Name = "Auto Drop Raw Gold",
    Default = false,
    Callback = function(v) 
        autoDropEnabled = v 
    end
})

AutoSection:Toggle({
    Name = "Auto Coin Press (Gold)",
    Default = false,
    Callback = function(v) 
        autoCoinPressEnabled = v 
    end
})

AutoSection:Textbox({
    Name = "Gold Item ID",
    Default = "50",
    Placeholder = "Enter Gold item ID...",
    Callback = function(v) 
        GOLD_ITEM_ID = tonumber(v) or 50
        print("[Config] Gold item ID set to: " .. GOLD_ITEM_ID)
    end
})

AutoSection:Textbox({
    Name = "Coin Machine Entity ID",
    Default = "21056",
    Placeholder = "Enter coin machine ID...",
    Callback = function(v) 
        COIN_MACHINE_ENTITY_ID = tonumber(v) or 21056
        print("[Config] Coin machine ID set to: " .. COIN_MACHINE_ENTITY_ID)
    end
})

-- [[ MAIN LOOP ]] --
task.spawn(function()
    loadPoints()
    local lastAutoDropTime = 0
    
    while true do
        task.wait(0.1)
        
        -- Auto coin press (every 2 seconds)
        if autoCoinPressEnabled and tick() - lastAutoDropTime >= 2 then
            pressCoinWithGold()
        end
        
        if goldFarmEnabled and #goldFarmPoints > 0 then
            -- Auto drop check (every 30 seconds)
            if autoDropEnabled and dropPoint and tick() - lastAutoDropTime >= 30 then
                dropAllRawGold()
                lastAutoDropTime = tick()
            end
            
            for i, pos in ipairs(goldFarmPoints) do
                if not goldFarmEnabled then break end
                
                -- Walk to farm point
                walkTo(pos)
                task.wait(0.2)
                
                -- Mine at point
                local mining = true
                while mining and goldFarmEnabled do
                    local targets = {}
                    
                    -- Ice chunks
                    if workspace:FindFirstChild("Resources") then
                        for _, v in pairs(workspace.Resources:GetChildren()) do 
                            if v.Name:lower():find("ice") then 
                                table.insert(targets, v) 
                            end 
                        end
                    end
                    
                    -- Gold nodes
                    for _, v in pairs(workspace:GetChildren()) do 
                        if v.Name == "Gold Node" then 
                            table.insert(targets, v) 
                        end 
                    end

                    local foundTarget = false
                    for _, res in pairs(targets) do
                        if res.Parent and (res:GetPivot().Position - root.Position).Magnitude < 30 then
                            foundTarget = true
                            local eid = res:GetAttribute("EntityID")
                            
                            while res.Parent and goldFarmEnabled do
                                packets.SwingTool.send({eid})
                                task.wait(0.12)
                                pickupItems()
                                
                                if (res:GetPivot().Position - root.Position).Magnitude > 35 then 
                                    break 
                                end
                            end
                        end
                    end
                    
                    pickupItems()

                    if not foundTarget then
                        mining = false
                    end
                    task.wait(0.1)
                end
            end
        end
    end
end)

-- Cleanup
game:GetService("UserInputService").WindowFocused:Connect(function()
    if not goldFarmEnabled then
        for _, marker in pairs(pointMarkers) do
            marker:Destroy()
        end
        pointMarkers = {}
    end
end)

Window:Init()
